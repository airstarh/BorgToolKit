document.addEventListener('DOMContentLoaded', function () {
  class BannerComponent extends HTMLElement {
    constructor() {
      super();
      this._shadowRoot = this.attachShadow({ mode: "open" });
    }

    connectedCallback() {
      let source = this.getAttribute("source");
      this.data = this.getData(source);

      this._shadowRoot.innerHTML = `
        <style>
          .embedded-form__title {
            font-family: "Unbounded", cursive;
            font-size: 30px;
            line-height: 40px;
            color: #0f0f0f;
            font-weight: 400;
            margin-bottom: -20px;
            color: white;
            hyphens: none;
          }

          @keyframes gradientBackground {
            0% {
              background-position: 0% 50%;
            }
            50% {
              background-position: 100% 50%;
            }
            100% {
              background-position: 0% 50%;
            }
          }

          
          
          .embedded-form__caption {
            font-size: 24px;
            color: #f2f2f2;
            margin-top: 30px;
            margin-bottom: 20px;
            line-height: 30px;
            
          }
          .embedded-form {
            margin-top: 20px;
            margin-right: 20px;
            padding-top: 5px;
            background-color: #222222;
            background: linear-gradient(45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBackground 15s ease infinite;
            padding-right: 30px;
            border-radius: 20px;
            min-height: 200px;
            hyphens: unset;
            padding-left: 20px;
          }
   

          .embedded-form__button {
            border-radius: 10px;
            display: inline-block;
            padding-left: 30px;
            margin-bottom: 30px;
            width: 250px;
            min-width: 200px;
            text-align: center;
            background-color: white;
            font-family: 'Unbounded', cursive;
            color: black;
            text-decoration: none;
            font-size: 1em;
            padding: 12px 24px;
            border: 3px solid black;
            transition: all 0.3s ease-in-out;
          }
          .embedded-form__button:hover {
            text-decoration: none;
            background-color: white;
            transform: translateY(-3px);
          }
          .embedded-form__button:active {
            transform: translateY(2px);
          }
        </style>

        <div class="embedded-form">
          <p class="embedded-form__title">${this.data.header}</p>
          <p class="embedded-form__caption">${this.data.text}</p>
          <a href="${this.data.buttonLink}" class="embedded-form__button">${this.data.buttonLabel}</a>
        </div>
      `;

      this._shadowRoot.querySelector('.embedded-form__button').addEventListener('click', (event) => this.handleButtonClick(event));
    }

    handleButtonClick(event) {
      event.preventDefault(); // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ

      const pageUrl = window.location.href;
      const buttonLink = this.data.buttonLink;

      fetch('https://vir-lab.ru/banner/handle_click.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: 'url=' + encodeURIComponent(pageUrl),
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.text();
      })
      .then(data => {
        console.log('Click tracked:', data);
        // –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç—Ä–µ–∫–∏–Ω–≥–∞
        window.location.href = buttonLink;
      })
      .catch(error => {
        console.error('Error tracking click:', error);
        // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ —Ç—Ä–µ–∫–∏–Ω–≥ –Ω–µ —É–¥–∞–ª—Å—è
        // –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
      });
    }


    getData(source) {
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ source
      const data = {
        "seo": {
          "header": "–û–ø—è—Ç—å –ø—Ä–∏—à–ª–æ—Å—å –≥—É–≥–ª–∏—Ç—å –∫–∞–∫—É—é-—Ç–æ –º–µ–ª–æ—á—å?",
          "text": "–ù–∞—É—á–∏—Ç–µ—Å—å –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –≤&nbsp;HTML Academy –∏&nbsp;–¥–æ—Å—Ç–∞–≤–∞–π—Ç–µ –∑–Ω–∞–Ω–∏—è –∏–∑&nbsp;–≥–æ–ª–æ–≤—ã, –∞&nbsp;–Ω–µ&nbsp;–∏–∑&nbsp;–ø–æ–∏—Å–∫–æ–≤–∏–∫–æ–≤.",
          "buttonLink": "https://htmlacademy.ru/profession/frontender",
          "buttonLabel": "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
        },
        "prof-html": {
          "header": "–í—ë—Ä—Å—Ç–∫–∞ ‚Äî —ç—Ç–æ –±–∞–∑–∞",
          "text": "–ù–∞—É—á–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∞–π—Ç—ã –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ¬´–§—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫¬ª. –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è ‚Äî —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∞, –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —Ä–µ–∑—é–º–µ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—è —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.",
          "buttonLink": "https://htmlacademy.ru/profession/frontender",
          "buttonLabel": "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
        },
        "prof-things": {
          "header": "–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ ‚Äî —ç—Ç–æ –Ω–µ —Ç–æ–ª—å–∫–æ –∫–æ–¥",
          "text": "–ù–∞—É—á–∏—Ç–µ—Å—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ&nbsp;–≤—Å–µ–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –Ω–∞&nbsp;–ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ¬´–§—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫¬ª. –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è ‚Äî —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∞, –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —Ä–µ–∑—é–º–µ –∏&nbsp;–≥–∞—Ä–∞–Ω—Ç–∏—è —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.",
          "buttonLink": "https://htmlacademy.ru/profession/frontender",
          "buttonLabel": "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
        },
        "prof-study": {
          "header": "–ö–∞–∫ —Å—Ç–∞—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ—Ä–æ–º —Å&nbsp;–Ω—É–ª—è",
          "text": "–ù–∞—É—á–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∞–π—Ç—ã –∏&nbsp;–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞&nbsp;–ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ¬´–§—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫¬ª. –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è ‚Äî —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∞, –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —Ä–µ–∑—é–º–µ –∏&nbsp;–≥–∞—Ä–∞–Ω—Ç–∏—è —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.",
          "buttonLink": "https://htmlacademy.ru/profession/frontender",
          "buttonLabel": "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
        },
        "prof-job": {
          "header": "–ü—Ä–∏—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç–µ—Å—å –∫&nbsp;IT?",
          "text": "–ü—Ä–æ—Ñ–µ—Å—Å–∏—è ¬´–§—Ä–æ–Ω—Ç–µ–Ω–¥-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫¬ª ‚Äî —Ç–æ, —á—Ç–æ&nbsp;–Ω—É–∂–Ω–æ –¥–ª—è&nbsp;–±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞. –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è ‚Äî —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∞, –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —Ä–µ–∑—é–º–µ –∏&nbsp;–≥–∞—Ä–∞–Ω—Ç–∏—è —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.",
          "buttonLink": "https://htmlacademy.ru/profession/frontender",
          "buttonLabel": "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
        },
        "js-js": {
          "header": "JavaScript ‚Äî —ç—Ç–æ –ª–µ–≥–∫–æ",
          "text": "–ü—Ä–æ–π–¥–∏—Ç–µ —Ç—Ä–µ–Ω–∞–∂—ë—Ä –∏ —É–≤–∏–¥–∏—Ç–µ.",
          "buttonLink": "https://htmlacademy.ru/courses/343/run/1",
          "buttonLabel": "–î–∞–≤–∞–π—Ç–µ"
        },
        "js-study": {
          "header": "–°–º–µ–ª–æ –ø–∏—à–∏—Ç–µ –∫–æ–¥",
          "text": "–ù–∞—É—á–∏—Ç–µ—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∞–π—Ç—ã –∏&nbsp;–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞&nbsp;–ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ ¬´JavaScript-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫¬ª. –ü–æ—Å–ª–µ –æ–±—É—á–µ–Ω–∏—è ‚Äî —Å—Ç–∞–∂–∏—Ä–æ–≤–∫–∞, –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, —Ä–µ–∑—é–º–µ –∏&nbsp;–≥–∞—Ä–∞–Ω—Ç–∏—è —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.",
          "buttonLink": "https://htmlacademy.ru/profession/react",
          "buttonLabel": "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
        },
        "trainers": {
          "header": "üí™ –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å&nbsp;—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º&nbsp;‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω–æ",
          "text": "–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ HTML, CSS –∏&nbsp;JavaScript –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –ø–æ–∫–∞ –ø—É—Ç–∞–µ—Ç —Ç–µ–≥–∏ –∏ –∫–ª–∞—Å—Å—ã.",
          "buttonLink": "https://htmlacademy.ru/courses/intro-to-web-development",
          "buttonLabel": "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å"
        },
        "backend": {
          "header": "–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã –∏&nbsp;—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥, –∏&nbsp;–±—ç–∫–µ–Ω–¥?",
          "text": "–°—Ç–∞–Ω—å—Ç–µ —Ñ—É–ª—Å—Ç–µ–∫-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º. –ó–Ω–∞–Ω–∏–π –±–æ–ª—å—à–µ, –∑–∞—Ä–ø–ª–∞—Ç–∞ –≤—ã—à–µ, –∑–∞–¥–∞—á–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–µ–µ. –í—Å–µ–º—É –Ω–∞—É—á–∏–º –∏&nbsp;–ø–æ–º–æ–∂–µ–º —Å&nbsp;—Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º.",
          "buttonLink": "https://htmlacademy.ru/profession/fullstack",
          "buttonLabel": "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è"
        }
      };

      return data[source] || {};
    }
  }

  customElements.define("blog-banner", BannerComponent);
});
